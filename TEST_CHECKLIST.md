# SAT PDF Exporter 테스트 체크리스트

## 개선 사항 요약

### A) 종료 조건 개선
- ✅ progress가 "27/27"이고 다음 버튼이 비활성/없음일 때만 종료
- ✅ 연속 3회 실패 + 동일 상태 확인 시 종료
- ✅ 그 외에는 재시도/폴백 selector로 계속 진행

### B) getCurrentProblemNumber() 강화
- ✅ UI 상단 progress 표시 우선 파싱
- ✅ 여러 후보 selector 시도
- ✅ document.body.innerText에서 정규식으로 찾기
- ✅ question signature 폴백 구현

### C) 중복 방지 키 수정
- ✅ `${sectionType}-${moduleName}-${problemNumber}` 우선 사용
- ✅ problemNumber 없을 때만 signature hash 사용
- ✅ 중복 감지 상세 로그 추가

### D) NEXT 버튼 클릭 성공 판정 강화
- ✅ 문제 번호 변경 확인 (1순위)
- ✅ question signature 변경 확인 (2순위)
- ✅ progress 상태 변경 확인 (3순위)
- ✅ next 버튼 상태 변경 확인 (4순위)
- ✅ scrollIntoView 폴백
- ✅ 최대 3회 재시도

### E) 정답 UI 대기 로직 안전화
- ✅ 초록 박스 대기
- ✅ "정답" 텍스트 대기
- ✅ next 버튼 활성화 대기
- ✅ 타임아웃 설정 (최대 8초)

### F) Extension context invalidated 대응
- ✅ 에러 감지 및 안전 종료
- ✅ 수집된 문제 수 로그
- ✅ 사용자에게 toast 메시지 표시
- ✅ PDF 생성 함수에도 에러 처리 추가

## 테스트 체크리스트

### 1. 기본 기능 테스트
- [ ] "Export to PDF" 버튼이 화면에 표시되는가?
- [ ] 버튼 클릭 시 수집이 시작되는가?
- [ ] Toast 메시지가 정상적으로 표시되는가?

### 2. 문제 수집 테스트 (27문항 전체)
- [ ] Reading Module 1: 모든 문제가 수집되는가? (예상: ~13-14개)
- [ ] Reading Module 2: "모듈 2 시작" 버튼이 클릭되고 모든 문제가 수집되는가? (예상: ~13-14개)
- [ ] Math Module 1: Math 섹션으로 이동하고 모든 문제가 수집되는가? (예상: ~13-14개)
- [ ] Math Module 2: "모듈 2 시작" 버튼이 클릭되고 모든 문제가 수집되는가? (예상: ~13-14개)
- [ ] **총 27문항이 모두 수집되는가?**

### 3. 종료 조건 테스트
- [ ] 27/27 도달 시 정상 종료되는가?
- [ ] 다음 버튼이 없을 때 정상 종료되는가?
- [ ] 3번에서 멈추지 않고 계속 진행되는가?

### 4. 문제 번호 감지 테스트
- [ ] 콘솔에 "문제 번호 발견" 로그가 정상적으로 출력되는가?
- [ ] 문제 번호가 정확하게 파싱되는가? (1, 2, 3, ..., 27)
- [ ] 문제 번호를 못 찾을 때 signature 폴백이 작동하는가?

### 5. 중복 방지 테스트
- [ ] 같은 문제가 중복 저장되지 않는가?
- [ ] 콘솔에 "중복 감지" 로그가 출력되는가?
- [ ] 중복 키가 정확하게 생성되는가? (`reading-Module 1-1`, `reading-Module 1-2`, ...)

### 6. 다음 버튼 클릭 테스트
- [ ] 다음 버튼이 정상적으로 찾아지는가?
- [ ] 클릭 후 문제 번호가 변경되는가?
- [ ] 문제 번호 변경이 감지되는가?
- [ ] 실패 시 재시도가 작동하는가?
- [ ] scrollIntoView 폴백이 작동하는가?

### 7. 정답 UI 대기 테스트
- [ ] 선택지 클릭 후 정답 UI가 나타나는가?
- [ ] 초록 박스가 감지되는가?
- [ ] "정답" 텍스트가 감지되는가?
- [ ] next 버튼 활성화 대기가 작동하는가?
- [ ] 타임아웃이 적절하게 설정되어 있는가?

### 8. Extension Context Invalidated 테스트
- [ ] 확장 프로그램 재로드 시 에러가 감지되는가?
- [ ] 수집된 문제 수가 로그에 출력되는가?
- [ ] 사용자에게 적절한 메시지가 표시되는가?
- [ ] PDF 생성 중 에러가 발생해도 안전하게 처리되는가?

### 9. PDF 생성 테스트
- [ ] Problems.pdf가 정상적으로 생성되는가?
- [ ] Answers.pdf가 정상적으로 생성되는가?
- [ ] PDF에 모든 문제가 포함되어 있는가?
- [ ] 문제지에는 정답/해설이 없는가?
- [ ] 정답지에는 정답/해설이 포함되어 있는가?
- [ ] 푸터 "Generated by Our Service (Powered by Gemini)"가 표시되는가?

### 10. 로그 확인
콘솔에서 다음 로그들을 확인하세요:
- [ ] `[SAT PDF Exporter] 문제 번호 발견` - 문제 번호가 정상적으로 감지되는가?
- [ ] `[SAT PDF Exporter] 문제 번호 변경 확인` - 다음 버튼 클릭 성공이 확인되는가?
- [ ] `[SAT PDF Exporter] 중복 감지` - 중복이 정상적으로 감지되는가?
- [ ] `[SAT PDF Exporter] Progress 변경 확인` - progress 변경이 감지되는가?
- [ ] `[SAT PDF Exporter] 종료 조건 A/B 충족` - 종료 조건이 정확하게 작동하는가?
- [ ] `[SAT PDF Exporter] Extension context invalidated` - 에러가 감지되는가?

## 문제 발생 시 확인 사항

### "3번에서 멈춤" 문제
1. 콘솔에서 다음을 확인:
   - 문제 번호가 정확하게 감지되는가?
   - 다음 버튼이 찾아지는가?
   - 문제 번호 변경이 감지되는가?
   - 중복 감지 로그가 있는가?

2. 종료 조건 확인:
   - progress가 "3/27"인가?
   - 다음 버튼이 비활성화되어 있는가?
   - 연속 실패가 3회인가?

3. 폴백 전략 확인:
   - scrollIntoView가 시도되었는가?
   - 재시도가 3회까지 시도되었는가?
   - 다른 후보 버튼이 시도되었는가?

### Extension Context Invalidated 에러
1. 확장 프로그램이 재로드되었는지 확인
2. 페이지를 새로고침하고 다시 시도
3. 콘솔에서 수집된 문제 수 확인

### PDF 생성 실패
1. jsPDF가 정상적으로 로드되었는지 확인
2. manifest.json에서 jspdf.umd.min.js가 먼저 로드되는지 확인
3. 콘솔에서 에러 메시지 확인

## 성공 기준

✅ **최종 성공 기준:**
- 27문항이 모두 수집됨
- Problems.pdf와 Answers.pdf가 정상적으로 생성됨
- 콘솔에 에러가 없음
- 3번에서 멈추지 않고 끝까지 진행됨

